var endpoint="http://localhost:28751",apiKey="<insert a SHA-512 of a piece of text here>",systemInformations=[],vhSystemInformations=[],newSystemInformationsCount=0,collapsed=!0,templateVHost='<div class="si" id="siVH{{}}">  <div class="siVHHeader">    <img class="flatbtn" id="siVHToggleCollapse{{}}" src="img/angle-right.svg"></img>    <img class="icon" src="img/VMwareHost.svg"></img>    <label id="siVHHostname{{}}"></label>    <span id="siVHIPs{{}}"></span>    <span id="siVHTimestamp{{}}"></span>  </div>  <div class="siBody" id="siVHBody{{}}">    <ul>      <li id="siVHOS{{}}"></li>      <li id="siVHSystem{{}}"></li>      <li id="siVHBios{{}}"></li>      <li id="siVHBmcIp{{}}"></li>      <li id="siVHProcessors{{}}"></li>      <li id="siVHMemoryInGB{{}}"></li>      <li id="siVHDatastores{{}}"></li>      <li id="siVHDiskPaths{{}}"></li>      <li id="siVHNics{{}}"></li>    </ul>&emsp;&emsp;&emsp;    <img class="flatbtn" id="vhEdit{{}}" src="img/ellipsis-h.svg"></img>&emsp;    <img class="flatbtn" id="vhRemove{{}}" src="img/trash-alt.svg"></img>  </div>  <div class="vhVMContainer" id="vhVMContainer{{}}">  </div> </div>',templateVM='<div class="si" id="si{{}}">  <div class="siHeader">    <img class="flatbtn" id="siToggleCollapse{{}}" src="img/angle-right.svg"></img>    <img class="icon" id="siIcon{{}}" src="img/server.svg"></img>    <label id="siHostname{{}}"></label>    <span id="siIPs{{}}"></span>    <span id="siTimestamp{{}}"></span>  </div>  <div class="siBody" id="siBody{{}}">    <ul>      <li id="siOS{{}}"></li>      <li id="siSystem{{}}"></li>      <li id="siBaseboard{{}}"></li>      <li id="siBios{{}}"></li>      <li id="siBmcIp{{}}"></li>      <li id="siProcessors{{}}"></li>      <li id="siMemoryModules{{}}"></li>      <li id="siDisks{{}}"></li>      <li id="siNics{{}}"></li>    </ul>&emsp;&emsp;&nbsp;    <img class="flatbtn" id="remove{{}}" src="img/trash-alt.svg"></img>  </div></div>',vhSystemInformation=function(s){var e,n=this,t=[];++newSystemInformationsCount;var i="#siVH"+newSystemInformationsCount,o="#siVHToggleCollapse"+newSystemInformationsCount,a="#siVHHostname"+newSystemInformationsCount,r="#siVHIPs"+newSystemInformationsCount,m="#siVHTimestamp"+newSystemInformationsCount,l="#siVHBody"+newSystemInformationsCount,p="#siVHOS"+newSystemInformationsCount,c="#siVHSystem"+newSystemInformationsCount,d="#siVHBios"+newSystemInformationsCount,u="#siVHBmcIp"+newSystemInformationsCount,f="#siVHProcessors"+newSystemInformationsCount,h="#siVHMemoryInGB"+newSystemInformationsCount,y="#siVHDatastores"+newSystemInformationsCount,v="#siVHDiskPaths"+newSystemInformationsCount,I="#siVHNics"+newSystemInformationsCount,g="#vhEdit"+newSystemInformationsCount,S="#vhRemove"+newSystemInformationsCount,w="#vhVMContainer"+newSystemInformationsCount;$("#container").append(templateVHost.replace(/{{}}/g,newSystemInformationsCount)),this.updateInfo=function(s){try{e=s.hostname,t=s.vmHostnames.split("\t"),$(a).text(e),$(r).text(s.ips.replace(/\t/g,", "));var n=s.timeStampInSecondsSinceEpochUtc;n<1e10&&(n*=1e3),n=new Date(n+(new Date).getTimezoneOffset()*-1),$(m).text("(last updated: "+n.toLocaleString()+")"),$(p).html("OS:&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.os),$(c).html("System:&emsp;&emsp;&nbsp;&nbsp;"+s.system),$(d).html("BIOS:&emsp;&emsp;&emsp;&nbsp;&nbsp;"+s.bios),$(u).html("BMC IP:&emsp;&emsp;&nbsp;&nbsp;"+s.bmcIp),$(f).html("Processors:<ul></ul>"),$.each(s.processors.split("\t"),function(s,e){$(f+" ul").append("<li>"+e+"</li>")}),$(f+" ul").append("<li> (total "+s.numCpuCores+" cores, "+s.numCpuThreads+" threads)</li>"),$(h).html("Memory:&emsp;&emsp;&nbsp;"+s.memoryInGB+" GB"),$(y).html("Datastores:<ul></ul>"),$.each(s.datastores.split("\t"),function(s,e){$(y+" ul").append("<li>"+e+"</li>")}),$(v).html("Paths:<ul></ul>"),$.each(s.vDiskPaths.split("\t"),function(s,e){$(v+" ul").append("<li>"+e+"</li>")}),$(I).html("NICs:<ul></ul>"),$.each(s.nics.split("\t"),function(s,e){$(I+" ul").append("<li>"+e+"</li>")})}catch(s){handleError("Failed updating system information (vhost reachable?). See the console for details.",s)}},this.hostname=function(){return e},this.vms=function(){return t},this.vhVMContainer=function(){return w},this.collapsed=function(){return!$(l).is(":visible")},this.collapse=function(){$(l).hide(),$(o).attr("src","img/angle-right.svg")},this.uncollapse=function(){$(l).show(),$(o).attr("src","img/angle-down.svg")},$(o).click(function(){$(l).is(":visible")?n.collapse():n.uncollapse()}),$(S).click(function(){confirm("Are you sure that you want to remove this?")&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),vhSystemInformations=jQuery.grep(vhSystemInformations,function(s){return s!=n}),$(i).remove(),$.ajax({url:endpoint+"/vmwarehosts/remove?apiKey="+apiKey+"&hostname="+e,type:"DELETE"}),setTimeout(function(){refresh()},1e3))}),$(g).click(function(){$("#addEditVHost").show(),setContainerTopMargin(),$("#vhIpOrHostname").val(e),$("#vhUsername").val(""),$("#vhPassword").val(""),$("#vhVMs").val(t.join(", ")),$("#vhIpOrHostname").focus()}),this.collapse(),this.updateInfo(s)},systemInformation=function(s,e){var n,t,i=this,o=e;++newSystemInformationsCount;var a="#si"+newSystemInformationsCount,r="#siToggleCollapse"+newSystemInformationsCount,m="#siIcon"+newSystemInformationsCount,l="#siHostname"+newSystemInformationsCount,p="#siIPs"+newSystemInformationsCount,c="#siTimestamp"+newSystemInformationsCount,d="#siBody"+newSystemInformationsCount,u="#siOS"+newSystemInformationsCount,f="#siSystem"+newSystemInformationsCount,h="#siBaseboard"+newSystemInformationsCount,y="#siBios"+newSystemInformationsCount,v="#siBmcIp"+newSystemInformationsCount,I="#siProcessors"+newSystemInformationsCount,g="#siMemoryModules"+newSystemInformationsCount,S="#siDisks"+newSystemInformationsCount,w="#siNics"+newSystemInformationsCount,C="#remove"+newSystemInformationsCount;t=templateVM.replace(/{{}}/g,newSystemInformationsCount),$(e).append(t),this.updateInfo=function(s,e){try{o!=e&&($(a).detach(),$(e).append(t),o=e),s.system.indexOf("VMware")>=0?$(m).attr("src","img/VMwareVM.svg"):$(m).attr("src","img/server.svg"),n=s.hostname,$(l).text(n),$(p).text(s.ips.replace(/\t/g,", "));var i=s.timeStampInSecondsSinceEpochUtc;i<1e10&&(i*=1e3),i=new Date(i+(new Date).getTimezoneOffset()*-1),$(c).text("(last updated: "+i.toLocaleString()+")"),$(u).html("OS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s.os),$(f).html("System:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.system),$(h).html("Baseboard:&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;"+s.baseboard),$(y).html("BIOS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.bios),$(v).html("BMC IP:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.bmcIp),$(I).html("Processors:<ul></ul>"),$.each(s.processors.split("\t"),function(s,e){$(I+" ul").append("<li>"+e+"</li>")}),$(g).html("Memory modules:<ul></ul>"),$.each(s.memoryModules.split("\t"),function(s,e){$(g+" ul").append("<li>"+e+"</li>")}),$(S).html("Disks:<ul></ul>"),$.each(s.disks.split("\t"),function(s,e){$(S+" ul").append("<li>"+e+"</li>")}),$(w).html("NICs:<ul></ul>"),$.each(s.nics.split("\t"),function(s,e){$(w+" ul").append("<li>"+e+"</li>")})}catch(s){handleError("Failed updating system information (machine reachable?). See the console for details.",s)}},this.hostname=function(){return n},this.collapsed=function(){return!$(d).is(":visible")},this.collapse=function(){$(d).hide(),$(r).attr("src","img/angle-right.svg")},this.uncollapse=function(){$(d).show(),$(r).attr("src","img/angle-down.svg")},$(r).click(function(){$(d).is(":visible")?i.collapse():i.uncollapse()}),$(C).click(function(){confirm("Are you sure that you want to remove this?")&&(systemInformations=jQuery.grep(systemInformations,function(s){return s!=i}),$(a).remove(),$.ajax({url:endpoint+"/systeminformations/remove?apiKey="+apiKey+"&hostname="+n,type:"DELETE"}))}),this.collapse(),this.updateInfo(s,e)},refresh=function(){var s="Failed fetching system information (API connected?).";$.getJSON(endpoint+"/vmwarehosts/listsysteminformation?apiKey="+apiKey,function(s){$.each(s,function(s,e){addOrUpdateVHSystemInformation(e)})}).fail(function(e,n,t){handleError(s,s)}).always(function(){$.getJSON(endpoint+"/systeminformations/list?apiKey="+apiKey,function(s){$.each(s,function(s,e){var n=e.hostname,t="#container";$.each(vhSystemInformations,function(s,e){if($.inArray(n,e.vms())!=-1)return t=e.vhVMContainer(),!1}),addOrUpdateSystemInformation(e,t)})}).fail(function(e,n,t){handleError(s,s)}).always(function(){$(".preloader-wrapper").fadeOut(),$("body").removeClass("preloader-site")})})},addOrUpdateSystemInformation=function(s,e){var n=null;$.each(systemInformations,function(t,i){if(i.hostname()==s.hostname)return n=i,n.updateInfo(s,e),!1}),null==n&&systemInformations.push(new systemInformation(s,e))},addOrUpdateVHSystemInformation=function(s){var e=null;$.each(vhSystemInformations,function(n,t){if(t.hostname()==s.hostname)return e=t,e.updateInfo(s),!1}),null==e&&vhSystemInformations.push(new vhSystemInformation(s))},addEditVHost=function(){var s={hostname:$.trim($("#vhIpOrHostname").val()),vmHostnames:$.trim($("#vhVMs").val()).replace(/ /g,"").replace(/\t/g,"").replace(/,/g,"\t"),username:$.trim($("#vhUsername").val()),password:$("#vhPassword").val()};s.username.length||(s.username=".&DO_NOT_UPDATE_Credentials&.",s.password=""),s.hostname.length?(!s.password.length||s.password.length&&confirm("Caution! Credentials will be send over the network. Are you sure that you want to do this?"))&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$.ajax({url:endpoint+"/vmwarehosts/addorupdate?apiKey="+apiKey,data:JSON.stringify(s),contentType:"application/json; charset=utf-8",dataType:"json",type:"POST"}).success(function(){refresh()})):alert("All fields are mandatory, except for VMs.")},collapse=function(){collapsed=!collapsed;var s=0;$.each(systemInformations,function(e,n){n.collapsed()&&++s}),$.each(vhSystemInformations,function(e,n){n.collapsed()&&++s}),0==s?collapsed=!0:s==systemInformations.length+vhSystemInformations.length&&(collapsed=!1),$.each(systemInformations,function(s,e){collapsed?e.collapse():e.uncollapse()}),$.each(vhSystemInformations,function(s,e){collapsed?e.collapse():e.uncollapse()})},setContainerTopMargin=function(){$("#container").css("margin-top",$("#header").height()+20+"px")},handleError=function(s,e){$("#error").show(),$("#errorLabel").text(s),setContainerTopMargin(),console.error(e)},closeError=function(){$("#error").hide(),setContainerTopMargin()},addEditVHostShow=function(){$("#addEditVHost").show(),setContainerTopMargin(),$("#vhIpOrHostname").focus()};window.onerror=function(s,e,n){return handleError("Unspecified error occured. See the console for details.",s),!0};var main=function(){$("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$("#apiEndpoint").text(endpoint),$("#addvhost").click(function(){addEditVHostShow()}),$("#collapse").click(function(){collapse()}),$("#errorClose").click(function(){closeError()}),$("#vhApply").click(function(){addEditVHost()}),$("#vhCancel").click(function(){$("#addEditVHost").hide(),setContainerTopMargin(),$("#vhUsername").val(""),$("#vhPassword").val("")}),setTimeout(function(){refresh()},1e3),setInterval(function(){refresh()},3e4)};$(document).ready(main);