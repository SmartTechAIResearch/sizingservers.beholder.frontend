var endpoint="http://localhost:28751/systeminformations",endpointVH="http://localhost:28751/vmwarehosts",apiKey="<insert a SHA-512 of a piece of text here>",systemInformations=[],vhSystemInformations=[],newSystemInformationsCount=0,collapsed=!0,templateVHost='<div class="si" id="siVH{{}}"><div class="siVHHeader"><button class="btn" id="siVHToggleCollapse{{}}">></button>&nbsp;<label id="siVHIpOrHostname{{}}"></label>&nbsp;<span id="siVHTimestamp{{}}"></span></div><div class="siBody" id="siVHBody{{}}"><ul><li id="siVHOS{{}}"></li><li id="siVHSystem{{}}"> </li><li id="siVHBios{{}}"> </li><li id="siVHBmcIp{{}}"> </li><li id="siVHProcessors{{}}"> </li><li id="siVHMemoryInGB{{}}"></li><li id="siVHDatastores{{}}"></li><li id="siVHDiskPaths{{}}"> </li><li id="siVHNics{{}}"> </li></ul><button class="btn btn-default" id="vhEdit{{}}">...</button>&nbsp;<button class="btn btn-default" id="vhRemove{{}}"><img src="img/remove.png" /></button></div><div class="vhVMContainer" id="vhVMContainer{{}}"></div></div>',templateVM='<div class="si" id="si{{}}"><div class="siHeader"><button class="btn" id="siToggleCollapse{{}}">></button>&nbsp;<label id="siHostname{{}}"></label>&nbsp;<span id="siIPs{{}}"></span>&nbsp;<span id="siTimestamp{{}}"></span></div><div class="siBody" id="siBody{{}}"><ul><li id="siOS{{}}"></li><li id="siSystem{{}}"> </li><li id="siBaseboard{{}}"> </li><li id="siBios{{}}"> </li><li id="siBmcIp{{}}"> </li><li id="siProcessors{{}}"> </li><li id="siMemoryModules{{}}"></li><li id="siDisks{{}}"> </li><li id="siNics{{}}"> </li></ul><button class="btn btn-default" id="remove{{}}"><img src="img/remove.png" /></button></div></div>',vhSystemInformation=function(s){var t,e=this,n=[];++newSystemInformationsCount;var o="#siVH"+newSystemInformationsCount,i="#siVHToggleCollapse"+newSystemInformationsCount,a="#siVHIpOrHostname"+newSystemInformationsCount,m="#siVHTimestamp"+newSystemInformationsCount,r="#siVHBody"+newSystemInformationsCount,l="#siVHOS"+newSystemInformationsCount,p="#siVHSystem"+newSystemInformationsCount,d="#siVHBios"+newSystemInformationsCount,c="#siVHBmcIp"+newSystemInformationsCount,u="#siVHProcessors"+newSystemInformationsCount,f="#siVHMemoryInGB"+newSystemInformationsCount,h="#siVHDatastores"+newSystemInformationsCount,y="#siVHDiskPaths"+newSystemInformationsCount,I="#siVHNics"+newSystemInformationsCount,v="#vhEdit"+newSystemInformationsCount,S="#vhRemove"+newSystemInformationsCount,b="#vhVMContainer"+newSystemInformationsCount;$("#container").append(templateVHost.replace(/{{}}/g,newSystemInformationsCount)),this.updateInfo=function(s){t=s.ipOrHostname,n=s.vmHostnames.split("\t"),$(a).text("VHOST "+t);var e=s.timeStampInSecondsSinceEpochUtc;e<1e10&&(e*=1e3),e=new Date(e+(new Date).getTimezoneOffset()*-1),$(m).text("(last updated: "+e.toLocaleString()+")"),$(l).html("OS:&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.os),$(p).html("System:&emsp;&emsp;&nbsp;&nbsp;"+s.system),$(d).html("BIOS:&emsp;&emsp;&emsp;&nbsp;&nbsp;"+s.bios),$(c).html("BMC IP:&emsp;&emsp;&nbsp;&nbsp;"+s.bmcIp),$(u).html("Processors:&emsp;"+s.processors.replace(/\t/g,", ")+" (total "+s.numCpuCores+" cores, "+s.numCpuThreads+" threads)"),$(f).html("Memory:&emsp;&emsp;&nbsp;"+s.memoryInGB+" GB"),$(h).html("Datastores:<ul></ul>"),$.each(s.datastores.split("\t"),function(s,t){$(h+" ul").append("<li>"+t+"</li>")}),$(y).html("Paths:<ul></ul>"),$.each(s.vDiskPaths.split("\t"),function(s,t){$(y+" ul").append("<li>"+t+"</li>")}),$(I).html("NICs:<ul></ul>"),$.each(s.nics.split("\t"),function(s,t){$(I+" ul").append("<li>"+t+"</li>")})},this.ipOrHostname=function(){return t},this.vms=function(){return n},this.vhVMContainer=function(){return b},this.collapsed=function(){return!$(r).is(":visible")},this.collapse=function(){$(r).hide(),$(i).text(">")},this.uncollapse=function(){$(r).show(),$(i).text("V")},$(i).click(function(){$(r).is(":visible")?e.collapse():e.uncollapse()}),$(S).click(function(){confirm("Are you sure that you want to remove this?")&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),vhSystemInformations=jQuery.grep(vhSystemInformations,function(s){return s!=e}),$(o).remove(),$.ajax({url:endpointVH+"/remove?apiKey="+apiKey+"&ipOrHostname="+t,type:"DELETE"}),setTimeout(function(){refresh()},1e3))}),$(v).click(function(){$("#addEditVHost").show(),$("#container").css("margin-top",$("#header").height()+20+"px"),$("#vhIpOrHostname").val(t),$("#vhUsername").val(""),$("#vhPassword").val(""),$("#vhVMs").val(n.join(", "))}),this.collapse(),this.updateInfo(s)},systemInformation=function(s,t){var e,n,o=this,i=t;++newSystemInformationsCount;var a="#si"+newSystemInformationsCount,m="#siToggleCollapse"+newSystemInformationsCount,r="#siHostname"+newSystemInformationsCount,l="#siIPs"+newSystemInformationsCount,p="#siTimestamp"+newSystemInformationsCount,d="#siBody"+newSystemInformationsCount,c="#siOS"+newSystemInformationsCount,u="#siSystem"+newSystemInformationsCount,f="#siBaseboard"+newSystemInformationsCount,h="#siBios"+newSystemInformationsCount,y="#siBmcIp"+newSystemInformationsCount,I="#siProcessors"+newSystemInformationsCount,v="#siMemoryModules"+newSystemInformationsCount,S="#siDisks"+newSystemInformationsCount,b="#siNics"+newSystemInformationsCount,w="#remove"+newSystemInformationsCount;n=templateVM.replace(/{{}}/g,newSystemInformationsCount),$(t).append(n),this.updateInfo=function(s,t){i!=t&&($(a).detach(),$(t).append(n),i=t),e=s.hostname,$(r).text(e),$(l).text(s.ips.replace(/\t/g,", "));var o=s.timeStampInSecondsSinceEpochUtc;o<1e10&&(o*=1e3),o=new Date(o+(new Date).getTimezoneOffset()*-1),$(p).text("(last updated: "+o.toLocaleString()+")"),$(c).html("OS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s.os),$(u).html("System:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.system),$(f).html("Baseboard:&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;"+s.baseboard),$(h).html("BIOS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.bios),$(y).html("BMC IP:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.bmcIp),$(I).html("Processors:&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s.processors.replace(/\t/g,", ")),$(v).html("Memory modules:&emsp;"+s.memoryModules.replace(/\t/g,",")),$(S).html("Disks:<ul></ul>"),$.each(s.disks.split("\t"),function(s,t){$(S+" ul").append("<li>"+t+"</li>")}),$(b).html("NICs:<ul></ul>"),$.each(s.nics.split("\t"),function(s,t){$(b+" ul").append("<li>"+t+"</li>")})},this.hostname=function(){return e},this.collapsed=function(){return!$(d).is(":visible")},this.collapse=function(){$(d).hide(),$(m).text(">")},this.uncollapse=function(){$(d).show(),$(m).text("V")},$(m).click(function(){$(d).is(":visible")?o.collapse():o.uncollapse()}),$(w).click(function(){confirm("Are you sure that you want to remove this?")&&(systemInformations=jQuery.grep(systemInformations,function(s){return s!=o}),$(a).remove(),$.ajax({url:endpoint+"/remove?apiKey="+apiKey+"&hostname="+e,type:"DELETE"}))}),this.collapse(),this.updateInfo(s,t)},refresh=function(){$.getJSON(endpointVH+"/listsysteminformation?apiKey="+apiKey,function(s){$.each(s,function(s,t){addOrUpdateVHSystemInformation(t)})}).always(function(){$.getJSON(endpoint+"/list?apiKey="+apiKey,function(s){$.each(s,function(s,t){var e=t.hostname,n="#container";$.each(vhSystemInformations,function(s,t){if($.inArray(e,t.vms())!=-1)return n=t.vhVMContainer(),!1}),addOrUpdateSystemInformation(t,n)})}).always(function(){sortSystemInformationByHostname(),$(".preloader-wrapper").fadeOut(),$("body").removeClass("preloader-site")})})},addOrUpdateSystemInformation=function(s,t){var e=null;$.each(systemInformations,function(n,o){if(o.hostname()==s.hostname)return e=o,e.updateInfo(s,t),!1}),null==e&&systemInformations.push(new systemInformation(s,t))},addOrUpdateVHSystemInformation=function(s){var t=null;$.each(vhSystemInformations,function(e,n){if(n.ipOrHostname()==s.ipOrHostname)return t=n,t.updateInfo(s),!1}),null==t&&vhSystemInformations.push(new vhSystemInformation(s))},sortSystemInformationByHostname=function(){var s=$("#container").children();s.sort(function(s,t){var e=s.getAttribute("id").substring("si".length),n=t.getAttribute("id").substring("si".length),o=$("#siHostname"+e).text(),i=$("#siHostname"+n).text();return o>i?1:o<i?-1:0}),s.detach().appendTo($("#container"))},addEditVHost=function(){var s={ipOrHostname:$.trim($("#vhIpOrHostname").val()),vmHostnames:$.trim($("#vhVMs").val()).replace(/ /g,"").replace(/\t/g,"").replace(/,/g,"\t"),username:$.trim($("#vhUsername").val()),password:$("#vhPassword").val()};s.username.length||(s.username=".&DO_NOT_UPDATE_Credentials&.",s.password=""),s.ipOrHostname.length?(!s.password.length||s.password.length&&confirm("Caution! Credentials will be send over the network. Are you sure that you want to do this?"))&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$.ajax({url:endpointVH+"/addorupdate?apiKey="+apiKey,data:JSON.stringify(s),contentType:"application/json; charset=utf-8",dataType:"json",type:"POST"}).success(function(){refresh()})):alert("All fields are mandatory, except for VMs.")},collapse=function(){collapsed=!collapsed;var s=0;$.each(systemInformations,function(t,e){e.collapsed()&&++s}),$.each(vhSystemInformations,function(t,e){e.collapsed()&&++s}),0==s?collapsed=!0:s==systemInformations.length+vhSystemInformations.length&&(collapsed=!1),$.each(systemInformations,function(s,t){collapsed?t.collapse():t.uncollapse()}),$.each(vhSystemInformations,function(s,t){collapsed?t.collapse():t.uncollapse()})},addEditVHostShow=function(){$("#addEditVHost").show(),$("#container").css("margin-top",$("#header").height()+20+"px")},main=function(){$("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$("#addvhost").click(function(){addEditVHostShow()}),$("#collapse").click(function(){collapse()}),$("#vhApply").click(function(){addEditVHost()}),$("#vhCancel").click(function(){$("#addEditVHost").hide(),$("#container").css("margin-top",$("#header").height()+20+"px"),$("#vhUsername").val(""),$("#vhPassword").val("")}),setTimeout(function(){refresh()},1e3),setInterval(function(){refresh()},3e4)};$(document).ready(main);