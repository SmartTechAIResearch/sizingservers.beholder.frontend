var endpoint="http://localhost:28751",apiKey="<insert a SHA-512 of a piece of text here>",systemInformations=[],vhSystemInformations=[],newSystemInformationsCount=0,collapsed=!0,commentsFocus=!1,templateVHost='<div class="si" id="siVH{{}}">  <div class="siVHHeader">    <img class="flatbtn" id="siVHToggleCollapse{{}}" src="img/angle-right.svg"></img>    <img class="icon" src="img/VMwareHost.svg"></img>    <label id="siVHHostname{{}}"></label>    <span id="siVHIPs{{}}"></span>    <span id="siVHTimestamp{{}}"></span>  </div>  <div class="siBody" id="siVHBody{{}}">    <ul>      <li id="siVHOS{{}}"></li>      <li id="siVHSystem{{}}"></li>      <li id="siVHBios{{}}"></li>      <li id="siVHBmcIp{{}}"></li>      <li id="siVHProcessors{{}}"></li>      <li id="siVHMemoryInGB{{}}"></li>      <li id="siVHDatastores{{}}"></li>      <li id="siVHDiskPaths{{}}"></li>      <li id="siVHNics{{}}"></li>    </ul>&emsp;&emsp;&emsp;    <div>      <textarea id="siVHComments{{}}" placeholder="Comments"></textarea>    </div>    <img class="flatbtn" id="vhApply{{}}" src="img/check-circle.svg"></img>    <img class="flatbtn" id="vhEdit{{}}" src="img/ellipsis-h.svg"></img>    <img class="flatbtn" id="vhRemove{{}}" src="img/trash-alt.svg"></img>  </div>  <div class="vhVMContainer" id="vhVMContainer{{}}">  </div> </div>',templateVM='<div class="si" id="si{{}}">  <div class="siHeader">    <img class="flatbtn" id="siToggleCollapse{{}}" src="img/angle-right.svg"></img>    <img class="icon" id="siIcon{{}}" src="img/server.svg"></img>    <label id="siHostname{{}}"></label>    <span id="siIPs{{}}"></span>    <span id="siTimestamp{{}}"></span>  </div>  <div class="siBody" id="siBody{{}}">    <ul>      <li id="siOS{{}}"></li>      <li id="siSystem{{}}"></li>      <li id="siBaseboard{{}}"></li>      <li id="siBios{{}}"></li>      <li id="siBmcIp{{}}"></li>      <li id="siProcessors{{}}"></li>      <li id="siMemoryModules{{}}"></li>      <li id="siDisks{{}}"></li>      <li id="siNics{{}}"></li>    </ul>&emsp;&emsp;&nbsp;    <div>      <textarea id="siComments{{}}" placeholder="Comments"></textarea>    </div>    <img class="flatbtn" id="apply{{}}" src="img/check-circle.svg"></img>    <img class="flatbtn" id="remove{{}}" src="img/trash-alt.svg"></img>  </div></div>',vhSystemInformation=function(t){var s,e=this,n=[];++newSystemInformationsCount;var o="#siVH"+newSystemInformationsCount,i="#siVHToggleCollapse"+newSystemInformationsCount,a="#siVHHostname"+newSystemInformationsCount,r="#siVHIPs"+newSystemInformationsCount,m="#siVHTimestamp"+newSystemInformationsCount,l="#siVHBody"+newSystemInformationsCount,c="#siVHOS"+newSystemInformationsCount,p="#siVHSystem"+newSystemInformationsCount,d="#siVHBios"+newSystemInformationsCount,u="#siVHBmcIp"+newSystemInformationsCount,h="#siVHProcessors"+newSystemInformationsCount,f="#siVHMemoryInGB"+newSystemInformationsCount,y="#siVHDatastores"+newSystemInformationsCount,v="#siVHDiskPaths"+newSystemInformationsCount,I="#siVHNics"+newSystemInformationsCount,g="#siVHComments"+newSystemInformationsCount,S="#vhApply"+newSystemInformationsCount,w="#vhEdit"+newSystemInformationsCount,C="#vhRemove"+newSystemInformationsCount,H="#vhVMContainer"+newSystemInformationsCount;$("#container").append(templateVHost.replace(/{{}}/g,newSystemInformationsCount)),this.updateInfo=function(t){try{s=t.hostname,$(a).text(s);try{n=t.vmHostnames.split("\t")}catch(t){}try{$(r).text(t.ips.replace(/\t/g,", "))}catch(t){}try{var e=t.timeStampInSecondsSinceEpochUtc;e<1e10&&(e*=1e3),e=new Date(e+(new Date).getTimezoneOffset()*-1),$(m).text("(last updated: "+e.toLocaleString()+")")}catch(t){}try{$(c).html("OS:&emsp;&emsp;&emsp;&emsp;&nbsp;"+t.os)}catch(t){}try{$(p).html("System:&emsp;&emsp;&nbsp;&nbsp;"+t.system)}catch(t){}try{$(d).html("BIOS:&emsp;&emsp;&emsp;&nbsp;&nbsp;"+t.bios)}catch(t){}try{$(u).html("BMC IP:&emsp;&emsp;&nbsp;&nbsp;"+t.bmcIp)}catch(t){}try{$(h).html("Processors:<ul></ul>"),$.each(t.processors.split("\t"),function(t,s){$(h+" ul").append("<li>"+s+"</li>")}),$(h+" ul").append("<li> (total "+t.numCpuCores+" cores, "+t.numCpuThreads+" threads)</li>")}catch(t){}try{$(f).html("Memory:&emsp;&emsp;&nbsp;"+t.memoryInGB+" GB")}catch(t){}try{$(y).html("Datastores:<ul></ul>"),$.each(t.datastores.split("\t"),function(t,s){$(y+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(v).html("Paths:<ul></ul>"),$.each(t.vDiskPaths.split("\t"),function(t,s){$(v+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(I).html("NICs:<ul></ul>"),$.each(t.nics.split("\t"),function(t,s){$(I+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(g).is(":focus")||$(g).val(t.comments)}catch(t){}if(!t.responsive)throw $(a).text()+" NOT RESPONDING"}catch(t){$(a).text(t),$(m).text("(last fetch attempt: "+(new Date).toLocaleString()+")"),handleError("Failed updating system information (vhost reachable?). See the console for details.",t)}},this.hostname=function(){return s},this.vms=function(){return n},this.vhVMContainer=function(){return H},this.collapsed=function(){return!$(l).is(":visible")},this.collapse=function(){$(l).hide(),$(i).attr("src","img/angle-right.svg")},this.uncollapse=function(){$(l).show(),$(i).attr("src","img/angle-down.svg")},$(i).click(function(){$(l).is(":visible")?e.collapse():e.uncollapse()}),$(g).focusin(function(){commentsFocus=!0}),$(g).focusout(function(){commentsFocus=!1}),$(S).click(function(){var t=JSON.stringify($(g).val());$.ajax({url:endpoint+"/vmwarehosts/addorupdatecomments?apiKey="+apiKey+"&hostname="+s,data:t,type:"PUT",contentType:"application/json; charset=utf-8",dataType:"json"})}),$(C).click(function(){confirm("Are you sure that you want to remove this?")&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),vhSystemInformations=jQuery.grep(vhSystemInformations,function(t){return t!=e}),$(o).remove(),$.ajax({url:endpoint+"/vmwarehosts/remove?apiKey="+apiKey+"&hostname="+s,type:"DELETE"}),setTimeout(function(){refresh()},1e3))}),$(w).click(function(){$("#addEditVHost").show(),setContainerTopMargin(),$("#vhIpOrHostname").val(s),$("#vhUsername").val(""),$("#vhPassword").val(""),$("#vhVMs").val(n.join(", ")),$("#vhIpOrHostname").focus()}),this.collapse(),this.updateInfo(t)},systemInformation=function(t,s){var e,n,o=this,i=s;++newSystemInformationsCount;var a="#si"+newSystemInformationsCount,r="#siToggleCollapse"+newSystemInformationsCount,m="#siIcon"+newSystemInformationsCount,l="#siHostname"+newSystemInformationsCount,c="#siIPs"+newSystemInformationsCount,p="#siTimestamp"+newSystemInformationsCount,d="#siBody"+newSystemInformationsCount,u="#siOS"+newSystemInformationsCount,h="#siSystem"+newSystemInformationsCount,f="#siBaseboard"+newSystemInformationsCount,y="#siBios"+newSystemInformationsCount,v="#siBmcIp"+newSystemInformationsCount,I="#siProcessors"+newSystemInformationsCount,g="#siMemoryModules"+newSystemInformationsCount,S="#siDisks"+newSystemInformationsCount,w="#siNics"+newSystemInformationsCount,C="#siComments"+newSystemInformationsCount,H="#apply"+newSystemInformationsCount,V="#remove"+newSystemInformationsCount;n=templateVM.replace(/{{}}/g,newSystemInformationsCount),$(s).append(n),this.updateInfo=function(t,s){try{i!=s&&($(a).detach(),$(s).append(n),i=s),t.system.indexOf("VMware")>=0?$(m).attr("src","img/VMwareVM.svg"):$(m).attr("src","img/server.svg");try{e=t.hostname,$(l).text(e)}catch(t){}try{$(c).text(t.ips.replace(/\t/g,", "))}catch(t){}try{var o=t.timeStampInSecondsSinceEpochUtc;o<1e10&&(o*=1e3),o=new Date(o+(new Date).getTimezoneOffset()*-1),$(p).text("(last updated: "+o.toLocaleString()+")")}catch(t){}try{$(u).html("OS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;"+t.os)}catch(t){}try{$(h).html("System:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+t.system)}catch(t){}try{$(f).html("Baseboard:&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;"+t.baseboard)}catch(t){}try{$(y).html("BIOS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+t.bios)}catch(t){}try{$(v).html("BMC IP:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+t.bmcIp)}catch(t){}try{$(I).html("Processors:<ul></ul>"),$.each(t.processors.split("\t"),function(t,s){$(I+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(g).html("Memory modules:<ul></ul>"),$.each(t.memoryModules.split("\t"),function(t,s){$(g+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(S).html("Disks:<ul></ul>"),$.each(t.disks.split("\t"),function(t,s){$(S+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(w).html("NICs:<ul></ul>"),$.each(t.nics.split("\t"),function(t,s){$(w+" ul").append("<li>"+s+"</li>")})}catch(t){}try{$(C).is(":focus")||$(C).val(t.comments)}catch(t){}if(!t.responsive)throw $(l).text()+" NOT RESPONDING"}catch(t){$(l).text(t),$(p).text("(last fetch attempt: "+(new Date).toLocaleString()+")"),handleError("Failed updating system information (machine reachable?). See the console for details.",t)}},this.hostname=function(){return e},this.collapsed=function(){return!$(d).is(":visible")},this.collapse=function(){$(d).hide(),$(r).attr("src","img/angle-right.svg")},this.uncollapse=function(){$(d).show(),$(r).attr("src","img/angle-down.svg")},$(r).click(function(){$(d).is(":visible")?o.collapse():o.uncollapse()}),$(C).focusin(function(){commentsFocus=!0}),$(C).focusout(function(){commentsFocus=!1}),$(H).click(function(){var t=JSON.stringify($(C).val());$.ajax({url:endpoint+"/systeminformations/addorupdatecomments?apiKey="+apiKey+"&hostname="+e,data:t,type:"PUT",contentType:"application/json; charset=utf-8",dataType:"json"})}),$(V).click(function(){confirm("Are you sure that you want to remove this?")&&(systemInformations=jQuery.grep(systemInformations,function(t){return t!=o}),$(a).remove(),$.ajax({url:endpoint+"/systeminformations/remove?apiKey="+apiKey+"&hostname="+e,type:"DELETE"}))}),this.collapse(),this.updateInfo(t,s)},refresh=function(){if(!commentsFocus){var t="Failed fetching system information (API connected?).";$.getJSON(endpoint+"/vmwarehosts/listsysteminformation?apiKey="+apiKey,function(t){$.each(t,function(t,s){addOrUpdateVHSystemInformation(s)})}).fail(function(s,e,n){handleError(t,t)}).always(function(){$.getJSON(endpoint+"/systeminformations/list?apiKey="+apiKey,function(t){$.each(t,function(t,s){var e=s.hostname,n="#container";$.each(vhSystemInformations,function(t,s){if($.inArray(e,s.vms())!=-1)return n=s.vhVMContainer(),!1}),addOrUpdateSystemInformation(s,n)})}).fail(function(s,e,n){handleError(t,t)}).always(function(){$(".preloader-wrapper").fadeOut(),$("body").removeClass("preloader-site")})})}},addOrUpdateSystemInformation=function(t,s){var e=null;$.each(systemInformations,function(n,o){if(o.hostname()==t.hostname)return e=o,e.updateInfo(t,s),!1}),null==e&&systemInformations.push(new systemInformation(t,s))},addOrUpdateVHSystemInformation=function(t){var s=null;$.each(vhSystemInformations,function(e,n){if(n.hostname()==t.hostname)return s=n,s.updateInfo(t),!1}),null==s&&vhSystemInformations.push(new vhSystemInformation(t))},addEditVHost=function(){var t={hostname:$.trim($("#vhIpOrHostname").val()),vmHostnames:$.trim($("#vhVMs").val()).replace(/ /g,"").replace(/\t/g,"").replace(/,/g,"\t"),username:$.trim($("#vhUsername").val()),password:$("#vhPassword").val()};t.username.length||(t.username=".&DO_NOT_UPDATE_Credentials&.",t.password=""),t.hostname.length?(!t.password.length||t.password.length&&confirm("Caution! Credentials will be send over the network. Are you sure that you want to do this?"))&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$.ajax({url:endpoint+"/vmwarehosts/addorupdate?apiKey="+apiKey,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",type:"POST"}).success(function(){refresh()})):alert("All fields are mandatory, except for VMs.")},collapse=function(){collapsed=!collapsed;var t=0;$.each(systemInformations,function(s,e){e.collapsed()&&++t}),$.each(vhSystemInformations,function(s,e){e.collapsed()&&++t}),0==t?collapsed=!0:t==systemInformations.length+vhSystemInformations.length&&(collapsed=!1),$.each(systemInformations,function(t,s){collapsed?s.collapse():s.uncollapse()}),$.each(vhSystemInformations,function(t,s){collapsed?s.collapse():s.uncollapse()})},setContainerTopMargin=function(){$("#container").css("margin-top",$("#header").height()+20+"px")},handleError=function(t,s){$("#error").show(),$("#errorLabel").text(t),setContainerTopMargin(),console.error(s)},closeError=function(){$("#error").hide(),setContainerTopMargin()},addEditVHostShow=function(){$("#addEditVHost").show(),setContainerTopMargin(),$("#vhIpOrHostname").focus()};window.onerror=function(t,s,e){return handleError("Unspecified error occured. See the console for details.",t),!0};var main=function(){$("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$("#apiEndpoint").text(endpoint),$("#addvhost").click(function(){addEditVHostShow()}),$("#collapse").click(function(){collapse()}),$("#errorClose").click(function(){closeError()}),$("#vhApply").click(function(){addEditVHost()}),$("#vhCancel").click(function(){$("#addEditVHost").hide(),setContainerTopMargin(),$("#vhUsername").val(""),$("#vhPassword").val("")}),setTimeout(function(){refresh()},1e3),setInterval(function(){refresh()},3e4)};$(document).ready(main);