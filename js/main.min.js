var endpoint="http://localhost:28751",apiKey="<insert a SHA-512 of a piece of text here>",systemInformations=[],vhSystemInformations=[],newSystemInformationsCount=0,collapsed=!0,templateVHost='<div class="si" id="siVH{{}}">  <div class="siVHHeader">    <img class="flatbtn" id="siVHToggleCollapse{{}}" src="img/angle-right.svg"></img>    <label id="siVHHostname{{}}"></label>    <span id="siVHIPs{{}}"></span>    <span id="siVHTimestamp{{}}"></span>  </div>  <div class="siBody" id="siVHBody{{}}">    <ul>      <li id="siVHOS{{}}"></li>      <li id="siVHSystem{{}}"></li>      <li id="siVHBios{{}}"></li>      <li id="siVHBmcIp{{}}"></li>      <li id="siVHProcessors{{}}"></li>      <li id="siVHMemoryInGB{{}}"></li>      <li id="siVHDatastores{{}}"></li>      <li id="siVHDiskPaths{{}}"></li>      <li id="siVHNics{{}}"></li>    </ul>&emsp;&emsp;&emsp;    <img class="flatbtn" id="vhEdit{{}}" src="img/ellipsis-h.svg"></img>&emsp;    <img class="flatbtn" id="vhRemove{{}}" src="img/trash-alt.svg"></img>  </div>  <div class="vhVMContainer" id="vhVMContainer{{}}">  </div> </div>',templateVM='<div class="si" id="si{{}}">  <div class="siHeader">    <img class="flatbtn" id="siToggleCollapse{{}}" src="img/angle-right.svg"></img>    <label id="siHostname{{}}"></label>    <span id="siIPs{{}}"></span>    <span id="siTimestamp{{}}"></span>  </div>  <div class="siBody" id="siBody{{}}">    <ul>      <li id="siOS{{}}"></li>      <li id="siSystem{{}}"></li>      <li id="siBaseboard{{}}"></li>      <li id="siBios{{}}"></li>      <li id="siBmcIp{{}}"></li>      <li id="siProcessors{{}}"></li>      <li id="siMemoryModules{{}}"></li>      <li id="siDisks{{}}"></li>      <li id="siNics{{}}"></li>    </ul>&emsp;&emsp;&nbsp;    <img class="flatbtn" id="remove{{}}" src="img/trash-alt.svg"></img>  </div></div>',vhSystemInformation=function(s){var e,t=this,n=[];++newSystemInformationsCount;var i="#siVH"+newSystemInformationsCount,o="#siVHToggleCollapse"+newSystemInformationsCount,a="#siVHHostname"+newSystemInformationsCount,r="#siVHIPs"+newSystemInformationsCount,m="#siVHTimestamp"+newSystemInformationsCount,l="#siVHBody"+newSystemInformationsCount,p="#siVHOS"+newSystemInformationsCount,c="#siVHSystem"+newSystemInformationsCount,d="#siVHBios"+newSystemInformationsCount,u="#siVHBmcIp"+newSystemInformationsCount,f="#siVHProcessors"+newSystemInformationsCount,h="#siVHMemoryInGB"+newSystemInformationsCount,y="#siVHDatastores"+newSystemInformationsCount,v="#siVHDiskPaths"+newSystemInformationsCount,I="#siVHNics"+newSystemInformationsCount,S="#vhEdit"+newSystemInformationsCount,g="#vhRemove"+newSystemInformationsCount,w="#vhVMContainer"+newSystemInformationsCount;$("#container").append(templateVHost.replace(/{{}}/g,newSystemInformationsCount)),this.updateInfo=function(s){try{e=s.hostname,n=s.vmHostnames.split("\t"),$(a).text("VHOST "+e),$(r).text(s.ips.replace(/\t/g,", "));var t=s.timeStampInSecondsSinceEpochUtc;t<1e10&&(t*=1e3),t=new Date(t+(new Date).getTimezoneOffset()*-1),$(m).text("(last updated: "+t.toLocaleString()+")"),$(p).html("OS:&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.os),$(c).html("System:&emsp;&emsp;&nbsp;&nbsp;"+s.system),$(d).html("BIOS:&emsp;&emsp;&emsp;&nbsp;&nbsp;"+s.bios),$(u).html("BMC IP:&emsp;&emsp;&nbsp;&nbsp;"+s.bmcIp),$(f).html("Processors:<ul></ul>"),$.each(s.processors.split("\t"),function(s,e){$(f+" ul").append("<li>"+e+"</li>")}),$(f+" ul").append("<li> (total "+s.numCpuCores+" cores, "+s.numCpuThreads+" threads)</li>"),$(h).html("Memory:&emsp;&emsp;&nbsp;"+s.memoryInGB+" GB"),$(y).html("Datastores:<ul></ul>"),$.each(s.datastores.split("\t"),function(s,e){$(y+" ul").append("<li>"+e+"</li>")}),$(v).html("Paths:<ul></ul>"),$.each(s.vDiskPaths.split("\t"),function(s,e){$(v+" ul").append("<li>"+e+"</li>")}),$(I).html("NICs:<ul></ul>"),$.each(s.nics.split("\t"),function(s,e){$(I+" ul").append("<li>"+e+"</li>")})}catch(s){handleError("Failed updating system information (vhost reachable?). See the console for details.",s)}},this.hostname=function(){return e},this.vms=function(){return n},this.vhVMContainer=function(){return w},this.collapsed=function(){return!$(l).is(":visible")},this.collapse=function(){$(l).hide(),$(o).attr("src","img/angle-right.svg")},this.uncollapse=function(){$(l).show(),$(o).attr("src","img/angle-down.svg")},$(o).click(function(){$(l).is(":visible")?t.collapse():t.uncollapse()}),$(g).click(function(){confirm("Are you sure that you want to remove this?")&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),vhSystemInformations=jQuery.grep(vhSystemInformations,function(s){return s!=t}),$(i).remove(),$.ajax({url:endpoint+"/vmwarehosts/remove?apiKey="+apiKey+"&hostname="+e,type:"DELETE"}),setTimeout(function(){refresh()},1e3))}),$(S).click(function(){$("#addEditVHost").show(),setContainerTopMargin(),$("#vhIpOrHostname").val(e),$("#vhUsername").val(""),$("#vhPassword").val(""),$("#vhVMs").val(n.join(", ")),$("#vhIpOrHostname").focus()}),this.collapse(),this.updateInfo(s)},systemInformation=function(s,e){var t,n,i=this,o=e;++newSystemInformationsCount;var a="#si"+newSystemInformationsCount,r="#siToggleCollapse"+newSystemInformationsCount,m="#siHostname"+newSystemInformationsCount,l="#siIPs"+newSystemInformationsCount,p="#siTimestamp"+newSystemInformationsCount,c="#siBody"+newSystemInformationsCount,d="#siOS"+newSystemInformationsCount,u="#siSystem"+newSystemInformationsCount,f="#siBaseboard"+newSystemInformationsCount,h="#siBios"+newSystemInformationsCount,y="#siBmcIp"+newSystemInformationsCount,v="#siProcessors"+newSystemInformationsCount,I="#siMemoryModules"+newSystemInformationsCount,S="#siDisks"+newSystemInformationsCount,g="#siNics"+newSystemInformationsCount,w="#remove"+newSystemInformationsCount;n=templateVM.replace(/{{}}/g,newSystemInformationsCount),$(e).append(n),this.updateInfo=function(s,e){try{o!=e&&($(a).detach(),$(e).append(n),o=e),t=s.hostname,$(m).text(t),$(l).text(s.ips.replace(/\t/g,", "));var i=s.timeStampInSecondsSinceEpochUtc;i<1e10&&(i*=1e3),i=new Date(i+(new Date).getTimezoneOffset()*-1),$(p).text("(last updated: "+i.toLocaleString()+")"),$(d).html("OS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s.os),$(u).html("System:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.system),$(f).html("Baseboard:&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;"+s.baseboard),$(h).html("BIOS:&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.bios),$(y).html("BMC IP:&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;"+s.bmcIp),$(v).html("Processors:<ul></ul>"),$.each(s.processors.split("\t"),function(s,e){$(v+" ul").append("<li>"+e+"</li>")}),$(I).html("Memory modules:<ul></ul>"),$.each(s.memoryModules.split("\t"),function(s,e){$(I+" ul").append("<li>"+e+"</li>")}),$(S).html("Disks:<ul></ul>"),$.each(s.disks.split("\t"),function(s,e){$(S+" ul").append("<li>"+e+"</li>")}),$(g).html("NICs:<ul></ul>"),$.each(s.nics.split("\t"),function(s,e){$(g+" ul").append("<li>"+e+"</li>")})}catch(s){handleError("Failed updating system information (machine reachable?). See the console for details.",s)}},this.hostname=function(){return t},this.collapsed=function(){return!$(c).is(":visible")},this.collapse=function(){$(c).hide(),$(r).attr("src","img/angle-right.svg")},this.uncollapse=function(){$(c).show(),$(r).attr("src","img/angle-down.svg")},$(r).click(function(){$(c).is(":visible")?i.collapse():i.uncollapse()}),$(w).click(function(){confirm("Are you sure that you want to remove this?")&&(systemInformations=jQuery.grep(systemInformations,function(s){return s!=i}),$(a).remove(),$.ajax({url:endpoint+"/systeminformations/remove?apiKey="+apiKey+"&hostname="+t,type:"DELETE"}))}),this.collapse(),this.updateInfo(s,e)},refresh=function(){var s="Failed fetching system information (API connected?).";$.getJSON(endpoint+"/vmwarehosts/listsysteminformation?apiKey="+apiKey,function(s){$.each(s,function(s,e){addOrUpdateVHSystemInformation(e)})}).fail(function(e,t,n){handleError(s,s)}).always(function(){$.getJSON(endpoint+"/systeminformations/list?apiKey="+apiKey,function(s){$.each(s,function(s,e){var t=e.hostname,n="#container";$.each(vhSystemInformations,function(s,e){if($.inArray(t,e.vms())!=-1)return n=e.vhVMContainer(),!1}),addOrUpdateSystemInformation(e,n)})}).fail(function(e,t,n){handleError(s,s)}).always(function(){sortSystemInformationByHostname(),$(".preloader-wrapper").fadeOut(),$("body").removeClass("preloader-site")})})},addOrUpdateSystemInformation=function(s,e){var t=null;$.each(systemInformations,function(n,i){if(i.hostname()==s.hostname)return t=i,t.updateInfo(s,e),!1}),null==t&&systemInformations.push(new systemInformation(s,e))},addOrUpdateVHSystemInformation=function(s){var e=null;$.each(vhSystemInformations,function(t,n){if(n.hostname()==s.hostname)return e=n,e.updateInfo(s),!1}),null==e&&vhSystemInformations.push(new vhSystemInformation(s))},sortSystemInformationByHostname=function(){var s=$("#container").children();s.sort(function(s,e){var t=s.getAttribute("id").substring("si".length),n=e.getAttribute("id").substring("si".length),i=$("#siHostname"+t).text(),o=$("#siHostname"+n).text();return i>o?1:i<o?-1:0}),s.detach().appendTo($("#container"))},addEditVHost=function(){var s={hostname:$.trim($("#vhIpOrHostname").val()),vmHostnames:$.trim($("#vhVMs").val()).replace(/ /g,"").replace(/\t/g,"").replace(/,/g,"\t"),username:$.trim($("#vhUsername").val()),password:$("#vhPassword").val()};s.username.length||(s.username=".&DO_NOT_UPDATE_Credentials&.",s.password=""),s.hostname.length?(!s.password.length||s.password.length&&confirm("Caution! Credentials will be send over the network. Are you sure that you want to do this?"))&&($("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$.ajax({url:endpoint+"/vmwarehosts/addorupdate?apiKey="+apiKey,data:JSON.stringify(s),contentType:"application/json; charset=utf-8",dataType:"json",type:"POST"}).success(function(){refresh()})):alert("All fields are mandatory, except for VMs.")},collapse=function(){collapsed=!collapsed;var s=0;$.each(systemInformations,function(e,t){t.collapsed()&&++s}),$.each(vhSystemInformations,function(e,t){t.collapsed()&&++s}),0==s?collapsed=!0:s==systemInformations.length+vhSystemInformations.length&&(collapsed=!1),$.each(systemInformations,function(s,e){collapsed?e.collapse():e.uncollapse()}),$.each(vhSystemInformations,function(s,e){collapsed?e.collapse():e.uncollapse()})},setContainerTopMargin=function(){$("#container").css("margin-top",$("#header").height()+20+"px")},handleError=function(s,e){$("#error").show(),$("#errorLabel").text(s),setContainerTopMargin(),console.error(e)},closeError=function(){$("#error").hide(),setContainerTopMargin()},addEditVHostShow=function(){$("#addEditVHost").show(),setContainerTopMargin(),$("#vhIpOrHostname").focus()};window.onerror=function(s,e,t){return handleError("Unspecified error occured. See the console for details.",s),!0};var main=function(){$("body").addClass("preloader-site"),$(".preloader-wrapper").fadeIn(),$("#apiEndpoint").text(endpoint),$("#addvhost").click(function(){addEditVHostShow()}),$("#collapse").click(function(){collapse()}),$("#errorClose").click(function(){closeError()}),$("#vhApply").click(function(){addEditVHost()}),$("#vhCancel").click(function(){$("#addEditVHost").hide(),setContainerTopMargin(),$("#vhUsername").val(""),$("#vhPassword").val("")}),setTimeout(function(){refresh()},1e3),setInterval(function(){refresh()},3e4)};$(document).ready(main);